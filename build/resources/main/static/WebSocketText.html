<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>接口测试</title>
    <script type="text/javascript" rel="script" src="alphaChat.js"></script>
</head>
<body>
<div>
    文件：<input type="file" multiple name="files" id="fileId"/><br/>
    <button onclick="uploadFiles()">上传</button>
</div>


<script type="text/javascript" rel="script">

    function readFiles(files) {

    }

    function uploadFiles() {
        var fileNode=document.getElementById("fileId");
        let files=fileNode.files;
        for(let i=0;i<files.length;i++) {
            let reader=new FileReader();
            reader.readAsArrayBuffer(files[i]);
            reader.onload=function () {
                let buffer= reader.result;
                console.log(buffer);
                let  blob=new Blob([buffer],{type:files[i].type});
                //let blob=new Blob(buffer,{type:"text/plain"});
                startWebsocket(blob);
            };
        }
    }




    function fileinfo(files) {
        for(let i=0;i<files.length;i++){
            let f=files[i];
            console.log(f.name,f.size,f.type,f.lastModified);
            console.log(f);
        }
    }


    function randomString(len) {
        len = len || 32;
        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';    /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/
        var maxPos = $chars.length;
        var pwd = '';
        for (i = 0; i < len; i++) {
            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));
        }
        return pwd;
    }
    function ab2str(buf) {
        return String.fromCharCode.apply(null, new Uint8Array(buf));
    }
    // 字符串转为ArrayBuffer对象，参数为字符串
    function str2ab(str) {
        var buf = new ArrayBuffer(str.length*2); // 每个字符占用2个字节
        var bufView = new Uint16Array(buf);
        for (var i=0, strLen=str.length; i<strLen; i++) {
            bufView[i] = str.charCodeAt(i);
        }
        return buf;
    }

    function startWebsocket(buffer) {
        var ws=new WebSocket("ws://localhost:8081/alpha");

    }
</script>
</body>
</html>
